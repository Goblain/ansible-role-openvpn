---                                                                                                                                                                                                                                                                               
- apt: name=openvpn                                                                                                                                                                                                                                                               

- file: path=/var/log/openvpn state=directory                                                                                                                                                                                                                                     

- copy: src={{dh}} dest=/etc/openvpn/{{label}}-dh.pem                                                                                                                                                                                                                             
  when: dh is defined                                                                                                                                                                                                                                                             
  notify:                                                                                                                                                                                                                                                                         
  - openvpn restart                                                                                                                                                                                                                                                               

- copy: src={{ca}} dest=/etc/openvpn/{{label}}-ca.pem                                                                                                                                                                                                                             
  when: ca is defined                                                                                                                                                                                                                                                             
  notify:                                                                                                                                                                                                                                                                         
  - openvpn restart                                                                                                                                                                                                                                                               

- template: src=config.j2 dest=/etc/openvpn/{{ label }}.conf                                                                                                                                                                                                                      
  notify:                                                                                                                                                                                                                                                                         
  - openvpn restart                                                                                                                                                                                                                                                               

- copy: dest=/etc/openvpn/{{ label }}.p12 src={{ p12file }}                                                                                                                                                                                                                       
  when: p12file is defined                                                                                                                                                                                                                                                        
  notify:                                                                                                                                                                                                                                                                         
  - openvpn restart                                                                                                                                                                                                                                                               
